goog.provide('stuttaford.codex.model');
goog.require('cljs.core');
goog.require('om.core');
goog.require('om.core');
goog.require('datascript.core');
goog.require('datascript.core');
goog.require('datascript');
goog.require('datascript');
datascript.core.DB.prototype.om$core$IToCursor$ = true;
datascript.core.DB.prototype.om$core$IToCursor$_to_cursor$arity$2 = (function (this$,_){var this$__$1 = this;return this$__$1;
});
datascript.core.DB.prototype.om$core$IToCursor$_to_cursor$arity$3 = (function (this$,_,___$1){var this$__$1 = this;return this$__$1;
});
stuttaford.codex.model.make_db_from_datoms = (function make_db_from_datoms(datoms){return datascript.db_with(datascript.empty_db.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("link","category","link/category",-596283622),new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword("db","valueType","db/valueType",1827971944),new cljs.core.Keyword("db.type","ref","db.type/ref",-1728373079)], null),new cljs.core.Keyword("link","tags","link/tags",1765991695),new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword("db","cardinality","db/cardinality",-104975659),new cljs.core.Keyword("db.cardinality","many","db.cardinality/many",772806234),new cljs.core.Keyword("db","valueType","db/valueType",1827971944),new cljs.core.Keyword("db.type","ref","db.type/ref",-1728373079)], null)], null)], 0)),cljs.core.map.cljs$core$IFn$_invoke$arity$2((function (p__55411){var vec__55412 = p__55411;var e = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__55412,(0),null);var a = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__55412,(1),null);var v = cljs.core.nth.cljs$core$IFn$_invoke$arity$3(vec__55412,(2),null);return new cljs.core.PersistentVector(null, 4, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword("db","add","db/add",235286841),e,a,v], null);
}),datoms));
});
stuttaford.codex.model.ids__GT_entities = (function ids__GT_entities(db,ids){return cljs.core.map.cljs$core$IFn$_invoke$arity$2(cljs.core.partial.cljs$core$IFn$_invoke$arity$2(datascript.entity,db),ids);
});
stuttaford.codex.model.prepare_entities = (function prepare_entities(db,ids){return stuttaford.codex.model.ids__GT_entities(db,cljs.core.map.cljs$core$IFn$_invoke$arity$2(cljs.core.first,ids));
});
stuttaford.codex.model.prepare_categories = (function prepare_categories(db,categories){return cljs.core.sort_by.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("category","name","category/name",1793490219),stuttaford.codex.model.prepare_entities(db,categories));
});
stuttaford.codex.model.categories = (function categories(db){return stuttaford.codex.model.prepare_categories(db,(function (){var G__55415 = new cljs.core.PersistentVector(null, 4, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"find","find",496279456),new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Keyword(null,"where","where",-2044795965),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Keyword("category","name","category/name",1793490219)], null)], null);var G__55416 = db;return (datascript.q.cljs$core$IFn$_invoke$arity$2 ? datascript.q.cljs$core$IFn$_invoke$arity$2(G__55415,G__55416) : datascript.q.call(null,G__55415,G__55416));
})());
});
stuttaford.codex.model.regex = (function regex(search_term){return (new RegExp(search_term,"i"));
});
stuttaford.codex.model.search_fn_for_term = (function search_fn_for_term(search_term){return cljs.core.comp.cljs$core$IFn$_invoke$arity$2(cljs.core.boolean$,cljs.core.partial.cljs$core$IFn$_invoke$arity$2(cljs.core.re_find,stuttaford.codex.model.regex(search_term)));
});
stuttaford.codex.model.search_categories = (function search_categories(db,search_term){if(cljs.core.seq(search_term))
{var search_fn = stuttaford.codex.model.search_fn_for_term(search_term);return stuttaford.codex.model.prepare_categories(db,cljs.core.distinct(cljs.core.concat.cljs$core$IFn$_invoke$arity$variadic((function (){var G__55429 = new cljs.core.PersistentVector(null, 8, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"find","find",496279456),new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Keyword(null,"in","in",-1531184865),new cljs.core.Symbol(null,"$","$",-1580747756,null),new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Keyword(null,"where","where",-2044795965),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Keyword("category","name","category/name",1793490219),new cljs.core.Symbol(null,"?name","?name",2050703390,null)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Symbol(null,"?name","?name",2050703390,null))], null)], null);var G__55430 = db;var G__55431 = search_fn;return (datascript.q.cljs$core$IFn$_invoke$arity$3 ? datascript.q.cljs$core$IFn$_invoke$arity$3(G__55429,G__55430,G__55431) : datascript.q.call(null,G__55429,G__55430,G__55431));
})(),(function (){var G__55432 = new cljs.core.PersistentVector(null, 9, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"find","find",496279456),new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Keyword(null,"in","in",-1531184865),new cljs.core.Symbol(null,"$","$",-1580747756,null),new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Keyword(null,"where","where",-2044795965),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","category","link/category",-596283622),new cljs.core.Symbol(null,"?category","?category",-1976335079,null)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","title","link/title",629005793),new cljs.core.Symbol(null,"?title","?title",-835622503,null)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Symbol(null,"?title","?title",-835622503,null))], null)], null);var G__55433 = db;var G__55434 = search_fn;return (datascript.q.cljs$core$IFn$_invoke$arity$3 ? datascript.q.cljs$core$IFn$_invoke$arity$3(G__55432,G__55433,G__55434) : datascript.q.call(null,G__55432,G__55433,G__55434));
})(),cljs.core.array_seq([(function (){var G__55435 = new cljs.core.PersistentVector(null, 9, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"find","find",496279456),new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Keyword(null,"in","in",-1531184865),new cljs.core.Symbol(null,"$","$",-1580747756,null),new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Keyword(null,"where","where",-2044795965),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","category","link/category",-596283622),new cljs.core.Symbol(null,"?category","?category",-1976335079,null)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","uri","link/uri",-771684973),new cljs.core.Symbol(null,"?uri","?uri",252074649,null)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Symbol(null,"?uri","?uri",252074649,null))], null)], null);var G__55436 = db;var G__55437 = search_fn;return (datascript.q.cljs$core$IFn$_invoke$arity$3 ? datascript.q.cljs$core$IFn$_invoke$arity$3(G__55435,G__55436,G__55437) : datascript.q.call(null,G__55435,G__55436,G__55437));
})(),(function (){var G__55438 = new cljs.core.PersistentVector(null, 10, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"find","find",496279456),new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Keyword(null,"in","in",-1531184865),new cljs.core.Symbol(null,"$","$",-1580747756,null),new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Keyword(null,"where","where",-2044795965),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","category","link/category",-596283622),new cljs.core.Symbol(null,"?category","?category",-1976335079,null)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","tags","link/tags",1765991695),new cljs.core.Symbol(null,"?tag","?tag",157764474,null)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?tag","?tag",157764474,null),new cljs.core.Keyword("tag","name","tag/name",1843757015),new cljs.core.Symbol(null,"?name","?name",2050703390,null)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Symbol(null,"?name","?name",2050703390,null))], null)], null);var G__55439 = db;var G__55440 = search_fn;return (datascript.q.cljs$core$IFn$_invoke$arity$3 ? datascript.q.cljs$core$IFn$_invoke$arity$3(G__55438,G__55439,G__55440) : datascript.q.call(null,G__55438,G__55439,G__55440));
})()], 0))));
} else
{return cljs.core.PersistentHashSet.EMPTY;
}
});
stuttaford.codex.model.prepare_links = (function prepare_links(db,links){return cljs.core.sort_by.cljs$core$IFn$_invoke$arity$2(new cljs.core.Keyword("link","title","link/title",629005793),stuttaford.codex.model.prepare_entities(db,links));
});
stuttaford.codex.model.search_links_in_category = (function search_links_in_category(db,category,search_term){if(cljs.core.seq(search_term))
{var category__$1 = new cljs.core.Keyword("db","id","db/id",-1388397098).cljs$core$IFn$_invoke$arity$1(category);var search_fn = stuttaford.codex.model.search_fn_for_term(search_term);cljs.core.prn.cljs$core$IFn$_invoke$arity$variadic(cljs.core.array_seq([category__$1], 0));
return stuttaford.codex.model.prepare_links(db,cljs.core.distinct(cljs.core.concat.cljs$core$IFn$_invoke$arity$variadic((function (){var G__55453 = new cljs.core.PersistentVector(null, 10, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"find","find",496279456),new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword(null,"in","in",-1531184865),new cljs.core.Symbol(null,"$","$",-1580747756,null),new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Keyword(null,"where","where",-2044795965),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","category","link/category",-596283622),new cljs.core.Symbol(null,"?category","?category",-1976335079,null)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","title","link/title",629005793),new cljs.core.Symbol(null,"?title","?title",-835622503,null)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Symbol(null,"?title","?title",-835622503,null))], null)], null);var G__55454 = db;var G__55455 = category__$1;var G__55456 = search_fn;return (datascript.q.cljs$core$IFn$_invoke$arity$4 ? datascript.q.cljs$core$IFn$_invoke$arity$4(G__55453,G__55454,G__55455,G__55456) : datascript.q.call(null,G__55453,G__55454,G__55455,G__55456));
})(),(function (){var G__55457 = new cljs.core.PersistentVector(null, 10, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"find","find",496279456),new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword(null,"in","in",-1531184865),new cljs.core.Symbol(null,"$","$",-1580747756,null),new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Keyword(null,"where","where",-2044795965),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","category","link/category",-596283622),new cljs.core.Symbol(null,"?category","?category",-1976335079,null)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","uri","link/uri",-771684973),new cljs.core.Symbol(null,"?uri","?uri",252074649,null)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Symbol(null,"?uri","?uri",252074649,null))], null)], null);var G__55458 = db;var G__55459 = category__$1;var G__55460 = search_fn;return (datascript.q.cljs$core$IFn$_invoke$arity$4 ? datascript.q.cljs$core$IFn$_invoke$arity$4(G__55457,G__55458,G__55459,G__55460) : datascript.q.call(null,G__55457,G__55458,G__55459,G__55460));
})(),cljs.core.array_seq([(function (){var G__55461 = new cljs.core.PersistentVector(null, 11, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"find","find",496279456),new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword(null,"in","in",-1531184865),new cljs.core.Symbol(null,"$","$",-1580747756,null),new cljs.core.Symbol(null,"?category","?category",-1976335079,null),new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Keyword(null,"where","where",-2044795965),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","category","link/category",-596283622),new cljs.core.Symbol(null,"?category","?category",-1976335079,null)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?link","?link",-1108278055,null),new cljs.core.Keyword("link","tags","link/tags",1765991695),new cljs.core.Symbol(null,"?tag","?tag",157764474,null)], null),new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Symbol(null,"?tag","?tag",157764474,null),new cljs.core.Keyword("tag","name","tag/name",1843757015),new cljs.core.Symbol(null,"?name","?name",2050703390,null)], null),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [cljs.core.list(new cljs.core.Symbol(null,"?search-fn","?search-fn",714411607,null),new cljs.core.Symbol(null,"?name","?name",2050703390,null))], null)], null);var G__55462 = db;var G__55463 = category__$1;var G__55464 = search_fn;return (datascript.q.cljs$core$IFn$_invoke$arity$4 ? datascript.q.cljs$core$IFn$_invoke$arity$4(G__55461,G__55462,G__55463,G__55464) : datascript.q.call(null,G__55461,G__55462,G__55463,G__55464));
})()], 0))));
} else
{return cljs.core.PersistentHashSet.EMPTY;
}
});
stuttaford.codex.model.search_matches_tag_QMARK_ = (function search_matches_tag_QMARK_(tag_name,search_term){var and__19304__auto__ = cljs.core.seq(search_term);if(and__19304__auto__)
{return cljs.core.re_find(stuttaford.codex.model.regex(search_term),tag_name);
} else
{return and__19304__auto__;
}
});
//# sourceMappingURL=model.js.map